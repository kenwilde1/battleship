(()=>{"use strict";class e{constructor(e,t,a){this.id=e,this.length=t,this.coords=a}hit(e){return!!this.coords.includes(e)&&(this.length--,!0)}isSunk(){return this.length<1}}class t{constructor(){this.hits=0,this.misses=0,this.gameboardArray=[],this.shipList=[]}initializeGameboard(){for(let e=0;e<100;e++)this.gameboardArray[e]=[e,{isPlaced:!1,isHit:!1,shipID:null}];return this.gameboardArray}placeShip(t,a){const r=new e(t,a.length,a);this.shipList.push(r);for(let e=0;e<a.length;e++)this.gameboardArray[a[e]][1].isPlaced=!0,this.gameboardArray[a[e]][1].shipID=t;return this.gameboardArray.slice(a[0],a[a.length-1]+1)}receiveAttack(e){const t=this.gameboardArray[e][1];if(t.isPlaced&&!t.isHit){const a=t.shipID;return this.shipList.filter((r=>{r.id===a&&(r.hit(e),t.isHit=!0)})),this.hits++,!0}return this.gameboardArray[e][1].isHit=!0,this.misses++,!1}isGameOver(){return 0===this.shipList.reduce(((e,t)=>t.length+e),0)}}class a{constructor(e){this.userType=e}attack(e,t){let a=!1;for(;!a;){const e=Math.floor(100*Math.random());return t.receiveAttack(e)||(a=!0),e}}}function r(e,t){let a;for(a="human"===t?document.querySelector(".human-gameboard"):document.querySelector(".computer-gameboard");a.firstChild;)a.removeChild(a.lastChild);for(let t=0;t<100;t++){let r=document.createElement("div");e[t][1].isPlaced&&!e[t][1].isHit?r.className=`cell cell${t} ship`:!e[t][1].isPlaced&&e[t][1].isHit?r.className=`cell cell${t} ship missed`:e[t][1].isHit?r.className=`cell cell${t} ship attacked`:r.className=`cell cell${t}`,r.draggable=!0,r.ondragstart="event.dataTransfer.setData('text/plain',null)",a.appendChild(r)}}const i=[{id:0,length:2,coords:[0,1]},{id:1,length:3,coords:[20,30,40]},{id:2,length:3,coords:[35,36,37]},{id:3,length:4,coords:[72,73,74,75]},{id:4,length:5,coords:[94,95,96,97,98]}],s=[{id:0,length:2,coords:[0,1]},{id:1,length:3,coords:[10,20,30]},{id:2,length:3,coords:[35,36,37]},{id:3,length:4,coords:[82,83,84,85]},{id:4,length:5,coords:[94,95,96,97,98]}],c=new class{constructor(){this.humanGameboard=new t,this.humanArray=this.humanGameboard.initializeGameboard(),this.computerGameboard=new t,this.computerArray=this.computerGameboard.initializeGameboard(),this.currentPlayer="human",this.computerPlayer=new a,this.computerGameboardElement=document.querySelector(".computer-gameboard"),this.humanGameboardElement=document.querySelector(".human-gameboard")}addEventListeners(){document.querySelectorAll(".computer-gameboard .cell").forEach((e=>e.addEventListener("click",(e=>{let t;t=e.currentTarget.className.length>12?parseInt(e.currentTarget.className.slice(9,11)):parseInt(e.currentTarget.className.slice(9)),this.handleClick(t)||setTimeout((()=>{this.switchCurrentPlayer()}),1e3)}))))}addDrag(){document.querySelectorAll(".human-gameboard .cell").forEach((e=>{e.addEventListener("click",(e=>{console.log(e.currentTarget)}))}))}startGame(){this.computerGameboardElement.classList.remove("inactive"),this.humanGameboardElement.classList.add("inactive")}initializeGameboard(){this.placeAllShips(),r(this.humanArray,"human"),r(this.computerArray,"comp"),this.addEventListeners(),this.addDrag()}placeAllShips(){i.forEach((e=>this.humanGameboard.placeShip(e.id,e.coords))),s.forEach((e=>this.computerGameboard.placeShip(e.id,e.coords)))}handleClick(e){const t=this.computerGameboard.receiveAttack(e);return t?this.computerGameboardElement.classList.remove("inactive"):(this.computerGameboardElement.classList.add("inactive"),this.humanGameboardElement.classList.toggle("inactive")),r(this.computerArray,"comp"),this.addEventListeners(),this.computerGameboard.isGameOver()&&this.gameOver(),t}switchCurrentPlayer(){let e=!1;for(;!e;){const t=Math.floor(100*Math.random());this.humanArray[t][1].isHit||this.humanArray[t][1].isPlaced||(this.humanGameboard.receiveAttack(t),r(this.humanArray,"human"),this.computerGameboardElement.classList.remove("inactive"),this.humanGameboardElement.classList.add("inactive"),e=!0),!this.humanArray[t][1].isHit&&this.humanArray[t][1].isPlaced&&(this.humanGameboard.receiveAttack(t),r(this.humanArray,"human"),this.computerGameboardElement.classList.remove("inactive"),this.humanGameboardElement.classList.add("inactive"))}}gameOver(e){alert(`Game Over! ${e} wins!`),this.humanGameboard=new t,this.humanArray=this.humanGameboard.initializeGameboard(),this.computerGameboard=new t,this.computerArray=this.computerGameboard.initializeGameboard(),this.initializeGameboard()}};c.initializeGameboard(),document.querySelector(".header button").addEventListener("click",(()=>c.startGame()))})();